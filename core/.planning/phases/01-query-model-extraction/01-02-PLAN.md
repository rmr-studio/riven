---
phase: 01-query-model-extraction
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt
autonomous: true

must_haves:
  truths:
    - "WorkflowQueryEntityActionConfig imports query models from riven.core.models.entity.query"
    - "Original model definitions removed from WorkflowQueryEntityActionConfig.kt"
    - "Existing functionality unchanged (validate, execute methods work)"
    - "No duplicate type definitions exist"
  artifacts:
    - path: "src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt"
      provides: "Workflow config using extracted models"
      contains: "import riven.core.models.entity.query"
  key_links:
    - from: "WorkflowQueryEntityActionConfig.kt"
      to: "models/entity/query/*.kt"
      via: "import statements"
      pattern: "import riven\\.core\\.models\\.entity\\.query\\."
---

<objective>
Update WorkflowQueryEntityActionConfig to import from new shared location and remove duplicate model definitions.

Purpose: Complete the extraction by updating the original file to use the new shared models, establishing a single source of truth.

Output: WorkflowQueryEntityActionConfig.kt with imports from models/entity/query/ and no local model definitions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-query-model-extraction/01-01-SUMMARY.md
@src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt
@src/main/kotlin/riven/core/models/entity/query/EntityQuery.kt
@src/main/kotlin/riven/core/models/entity/query/QueryFilter.kt
@src/main/kotlin/riven/core/models/entity/query/RelationshipCondition.kt
@src/main/kotlin/riven/core/models/entity/query/QueryPagination.kt
@src/main/kotlin/riven/core/models/entity/query/QueryProjection.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update imports and remove duplicate definitions</name>
  <files>
    src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt
  </files>
  <action>
Modify WorkflowQueryEntityActionConfig.kt:

1. **Add imports** at the top of the file (after existing imports):
   ```kotlin
   import riven.core.models.entity.query.EntityQuery
   import riven.core.models.entity.query.FilterOperator
   import riven.core.models.entity.query.FilterValue
   import riven.core.models.entity.query.OrderByClause
   import riven.core.models.entity.query.QueryFilter
   import riven.core.models.entity.query.QueryPagination
   import riven.core.models.entity.query.QueryProjection
   import riven.core.models.entity.query.RelationshipCondition
   import riven.core.models.entity.query.SortDirection
   ```

2. **Remove local model definitions** - Delete everything from line ~357 to end of file (after the WorkflowQueryEntityActionConfig class closes):
   - Delete EntityQuery class (lines ~367-374)
   - Delete QueryFilter sealed interface and all subtypes (lines ~380-473)
   - Delete RelationshipCondition sealed interface and all subtypes (lines ~484-569)
   - Delete FilterValue sealed interface and subtypes (lines ~579-617)
   - Delete FilterOperator enum (lines ~627-669)
   - Delete QueryPagination class (lines ~683-692)
   - Delete OrderByClause class (lines ~700-707)
   - Delete SortDirection enum (lines ~713-719)
   - Delete QueryProjection class (lines ~735-753)
   - Delete all section comment blocks (// ===== ... ===== lines)

3. **Keep unchanged:**
   - Package declaration
   - All existing imports (except add new ones)
   - WorkflowQueryEntityActionConfig class definition (lines 129-355)
   - All validation methods (validateFilter, validateFilterValue, validateRelationshipCondition)
   - KDoc for the class
   - execute() method

The file should end after the closing brace of WorkflowQueryEntityActionConfig class.

**Note:** The validate methods reference QueryFilter, RelationshipCondition, FilterValue - these will now resolve via imports.
  </action>
  <verify>
1. Project compiles: `./gradlew compileKotlin`
2. No duplicate definitions: `grep -c "sealed interface QueryFilter" src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt` (should be 0)
3. Imports exist: `grep "import riven.core.models.entity.query" src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt`
4. Run tests: `./gradlew test --tests "*WorkflowQueryEntity*" 2>&1 | tail -20` (if tests exist)
  </verify>
  <done>
WorkflowQueryEntityActionConfig.kt imports from riven.core.models.entity.query. No local model definitions remain (file ends after class closing brace). Project compiles successfully.
  </done>
</task>

</tasks>

<verification>
After task completes:

1. Project compiles:
   - `./gradlew compileKotlin`

2. No duplicate type definitions:
   - `grep -c "enum class FilterOperator" src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt` (should output 0)
   - `grep -c "sealed interface QueryFilter" src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt` (should output 0)

3. Imports from new location:
   - `grep -c "import riven.core.models.entity.query" src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt` (should be >= 1)

4. WorkflowQueryEntityActionConfig class still exists:
   - `grep -c "class WorkflowQueryEntityActionConfig" src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt` (should be 1)

5. File size reduced significantly (was ~754 lines, should be ~360 lines)
   - `wc -l src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt`
</verification>

<success_criteria>
- WorkflowQueryEntityActionConfig.kt imports all query models from riven.core.models.entity.query
- No local definitions of EntityQuery, QueryFilter, RelationshipCondition, FilterValue, FilterOperator, QueryPagination, OrderByClause, SortDirection, QueryProjection
- File ends after WorkflowQueryEntityActionConfig class (no trailing model definitions)
- Project compiles with `./gradlew compileKotlin`
- All validation methods still work (reference imported types)
</success_criteria>

<output>
After completion, create `.planning/phases/01-query-model-extraction/01-02-SUMMARY.md`
</output>
