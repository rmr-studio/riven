---
phase: 07.2-workflow-state-management
plan: 03
subsystem: workflow
tags: [kotlin, sealed-interface, trigger, template-access, workflow-engine]

# Dependency graph
requires:
  - phase: 07.2-01
    provides: WorkflowDataStore and WorkflowMetadata classes
provides:
  - TriggerContext sealed interface for typed trigger data
  - EntityEventTrigger for entity create/update/delete events
  - WebhookTrigger for HTTP webhook invocations
  - ScheduleTrigger for cron and interval-based schedules
  - FunctionTrigger for function/API invocations
  - toMap() methods for template property access
affects: [07.2-04-input-resolver, 07.2-06-integration]

# Tech tracking
tech-stack:
  added: []
  patterns: [sealed-interface-with-toMap, trigger-context-hierarchy]

key-files:
  created:
    - src/main/kotlin/riven/core/models/workflow/engine/datastore/TriggerContext.kt
    - src/test/kotlin/riven/core/models/workflow/engine/datastore/TriggerContextTest.kt
  modified: []

key-decisions:
  - "Use OperationType enum for entity events (reuse existing enum, not new EntityEventType)"
  - "Entity data as Map<String, Any?> to avoid circular dependencies with Entity model"
  - "toMap() returns String-keyed map enabling {{ trigger.propertyName }} template resolution"
  - "scheduledAt converted to ISO string in toMap() for template compatibility"

patterns-established:
  - "TriggerContext sealed interface: Type-safe trigger variants with toMap() for template access"
  - "Nullable optionals in trigger data: cronExpression/interval/previousEntity null when not applicable"

# Metrics
duration: 2min
completed: 2026-02-01
---

# Phase 7.2 Plan 03: TriggerContext Summary

**Sealed interface TriggerContext with 4 typed trigger classes (EntityEvent, Webhook, Schedule, Function) providing toMap() for template property access**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-01T06:13:48Z
- **Completed:** 2026-02-01T06:15:19Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- TriggerContext sealed interface with 4 typed implementations
- EntityEventTrigger supports CREATE/UPDATE/DELETE with previous entity state
- WebhookTrigger exposes headers, body, queryParams for HTTP webhooks
- ScheduleTrigger handles both cron expressions and interval-based schedules
- FunctionTrigger provides access to function invocation arguments
- All trigger types have toMap() enabling {{ trigger.* }} template resolution

## Task Commits

Each task was committed atomically:

1. **Task 1: Create TriggerContext sealed interface with all trigger types** - `6f20896` (feat)
2. **Task 2: Unit tests for TriggerContext toMap() methods** - `268047c` (test)

## Files Created/Modified
- `src/main/kotlin/riven/core/models/workflow/engine/datastore/TriggerContext.kt` - Sealed interface with 4 trigger type implementations
- `src/test/kotlin/riven/core/models/workflow/engine/datastore/TriggerContextTest.kt` - Unit tests for all trigger types and toMap() behavior

## Decisions Made
- **OperationType reuse:** Used existing `riven.core.enums.util.OperationType` enum (CREATE, UPDATE, DELETE) instead of creating new EntityEventType
- **Entity as Map:** Entity data stored as `Map<String, Any?>` to avoid circular dependencies and enable flexible payload structure
- **scheduledAt as String:** Instant converted to ISO string in toMap() for consistent template resolution
- **Nullable optionals:** cronExpression/interval/previousEntity are nullable when not applicable to the trigger type

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- TriggerContext ready for integration with WorkflowDataStore
- toMap() interface enables template resolution via {{ trigger.* }} paths
- Ready for InputResolverService updates (plan 07.2-04)

---
*Phase: 07.2-workflow-state-management*
*Completed: 2026-02-01*
