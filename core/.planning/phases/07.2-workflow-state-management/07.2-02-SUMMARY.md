---
phase: 07.2-workflow-state-management
plan: 02
subsystem: workflow
tags: [kotlin, sealed-interface, type-safety, node-output, template-resolution]

# Dependency graph
requires:
  - phase: 07.2-01
    provides: WorkflowDataStore shell and TriggerContext
provides:
  - NodeOutput sealed interface with typed output classes
  - CreateEntityOutput, UpdateEntityOutput, DeleteEntityOutput, QueryEntityOutput
  - HttpResponseOutput with computed success property
  - ConditionOutput with backward-compat conditionResult alias
  - toMap() method for template property access
affects: [07.2-03, 07.2-04, workflow-coordination-service]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - sealed interface for type-safe polymorphism
    - computed property for derived values (success)
    - toMap() for template resolution bridge

key-files:
  created:
    - src/main/kotlin/riven/core/models/workflow/engine/datastore/NodeOutput.kt
    - src/test/kotlin/riven/core/models/workflow/engine/datastore/NodeOutputTest.kt
  modified: []

key-decisions:
  - "Backward compat conditionResult alias: result is primary, conditionResult aliases for existing DAG coordinator usage"
  - "Computed success property: HttpResponseOutput exposes success as derived property, included in toMap()"
  - "UUID keys in entity payloads: CreateEntityOutput/UpdateEntityOutput use Map<UUID, Any?> matching entity schema structure"

patterns-established:
  - "NodeOutput.toMap() pattern: all outputs expose properties as Map for template resolution"
  - "Sealed interface for output type safety: exhaustive when matching in coordinator"

# Metrics
duration: 2min
completed: 2026-02-01
---

# Phase 07.2 Plan 02: NodeOutput Type System Summary

**Sealed interface NodeOutput with 6 typed output classes for type-safe action results and template property access**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-01T06:13:33Z
- **Completed:** 2026-02-01T06:15:27Z
- **Tasks:** 2
- **Files created:** 2

## Accomplishments
- Created NodeOutput sealed interface as foundation for type-safe workflow outputs
- Implemented 6 output classes matching all current action/control node types
- Added toMap() bridge enabling template expressions like {{ steps.node.output.propertyName }}
- HttpResponseOutput computes success from status code (200-299 range)
- ConditionOutput maintains backward compatibility with existing conditionResult usage

## Task Commits

Each task was committed atomically:

1. **Task 1: Create NodeOutput sealed interface with all typed output classes** - `6539c36` (feat)
2. **Task 2: Unit tests for NodeOutput toMap() methods** - `a658a47` (test)

## Files Created/Modified

- `src/main/kotlin/riven/core/models/workflow/engine/datastore/NodeOutput.kt` - Sealed interface with 6 typed output classes
- `src/test/kotlin/riven/core/models/workflow/engine/datastore/NodeOutputTest.kt` - Comprehensive tests for all toMap() methods

## Decisions Made

1. **Backward compat conditionResult alias** - ConditionOutput exposes both `result` (canonical) and `conditionResult` (backward compat) in toMap(). The current WorkflowConditionControlConfig returns `conditionResult` key, so alias ensures smooth migration.

2. **Computed success property** - HttpResponseOutput's `success` is a computed property (`statusCode in 200..299`) exposed in toMap(). This enables templates like `{{ steps.http.output.success }}` without requiring workflow authors to check status codes.

3. **UUID keys in entity payloads** - Entity output payloads use `Map<UUID, Any?>` to match the existing EntityType schema structure where attribute keys are UUIDs.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- NodeOutput sealed interface ready for integration with WorkflowDataStore
- StepOutput can now use typed NodeOutput instead of Map<String, Any?>
- Template resolution service can call toMap() for property access
- Exhaustive when matching available for coordinator branching logic

---
*Phase: 07.2-workflow-state-management*
*Completed: 2026-02-01*
