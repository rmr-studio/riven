---
phase: 07.1-node-configuration-development
plan: 05
type: execute
wave: 4
depends_on: ["07.1-01", "07.1-04"]
files_modified:
  - src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowEntityEventTriggerConfig.kt
  - src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowScheduleTriggerConfig.kt
  - src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowFunctionTriggerConfig.kt
  - src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowWebhookTriggerConfig.kt
  - src/main/kotlin/riven/core/service/workflow/WorkflowGraphService.kt
autonomous: true

must_haves:
  truths:
    - "ENTITY_EVENT config validates key, operation, and expressions fields"
    - "SCHEDULE config validates either cronExpression or interval is provided"
    - "FUNCTION config validates schema is not null"
    - "WEBHOOK config validates method, authentication, signature, and payloadSchema"
    - "All trigger configs implement validate() method"
  artifacts:
    - path: "src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowEntityEventTriggerConfig.kt"
      provides: "ENTITY_EVENT trigger config with validation"
      contains: "fun validate"
    - path: "src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowScheduleTriggerConfig.kt"
      provides: "SCHEDULE trigger config with validation"
      contains: "fun validate"
    - path: "src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowFunctionTriggerConfig.kt"
      provides: "FUNCTION trigger config with validation"
      contains: "fun validate"
    - path: "src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowWebhookTriggerConfig.kt"
      provides: "WEBHOOK trigger config with validation"
      contains: "fun validate"
  key_links:
    - from: "WorkflowGraphService.validateConfig"
      to: "TriggerConfig.validate"
      via: "when clause for trigger configs"
      pattern: "is Workflow.*TriggerConfig"
---

<objective>
Add validate() methods to all 4 existing trigger configurations.

Purpose: Trigger configs already have typed fields but lack validation methods. Adding validate() enables consistent save-time validation across all node types.

Output: All trigger configs (ENTITY_EVENT, SCHEDULE, FUNCTION, WEBHOOK) with validate() methods returning ConfigValidationResult.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-node-configuration-development/07.1-CONTEXT.md
@.planning/phases/07.1-node-configuration-development/07.1-01-SUMMARY.md
@.planning/phases/07.1-node-configuration-development/07.1-04-SUMMARY.md
@src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowEntityEventTriggerConfig.kt
@src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowScheduleTriggerConfig.kt
@src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowFunctionTriggerConfig.kt
@src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowWebhookTriggerConfig.kt
@src/main/kotlin/riven/core/service/workflow/ConfigValidationService.kt
@src/main/kotlin/riven/core/service/workflow/WorkflowGraphService.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add validate() methods to ENTITY_EVENT and SCHEDULE trigger configs</name>
  <files>
    src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowEntityEventTriggerConfig.kt
    src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowScheduleTriggerConfig.kt
  </files>
  <action>
Add validate() methods to both trigger configs. The configs already have typed fields; we just need to add validation logic.

**WorkflowEntityEventTriggerConfig.kt:**

Add imports at top of file:
```kotlin
import riven.core.models.workflow.node.config.validation.ConfigValidationError
import riven.core.models.workflow.node.config.validation.ConfigValidationResult
import riven.core.service.workflow.ConfigValidationService
```

Add validate() method inside the data class (before the execute method):
```kotlin
/**
 * Validates this configuration.
 *
 * Checks:
 * - key is not blank (entity type key)
 * - operation is valid (already enforced by enum)
 * - expressions is provided (not null)
 */
fun validate(validationService: ConfigValidationService): ConfigValidationResult {
    val errors = mutableListOf<ConfigValidationError>()

    // Validate key (entity type key)
    errors.addAll(validationService.validateRequiredString(key, "key"))

    // operation is an enum, so it's always valid if deserialized

    // expressions should not be null (it's typed as Any which is non-null in Kotlin)
    // but validate it has content if it's a string or collection
    when (expressions) {
        is String -> {
            if ((expressions as String).isBlank()) {
                errors.add(ConfigValidationError("expressions", "Expressions cannot be blank"))
            }
        }
        is Collection<*> -> {
            if ((expressions as Collection<*>).isEmpty()) {
                errors.add(ConfigValidationError("expressions", "Expressions list cannot be empty"))
            }
        }
    }

    return ConfigValidationResult(errors)
}
```

**WorkflowScheduleTriggerConfig.kt:**

Add imports at top of file:
```kotlin
import riven.core.models.workflow.node.config.validation.ConfigValidationError
import riven.core.models.workflow.node.config.validation.ConfigValidationResult
import riven.core.service.workflow.ConfigValidationService
```

Add validate() method inside the data class (before the execute method):
```kotlin
/**
 * Validates this configuration.
 *
 * Checks:
 * - Either cronExpression or interval is provided (already in init block)
 * - cronExpression has valid format if provided
 * - interval is positive if provided
 * - timeZone is valid
 */
fun validate(validationService: ConfigValidationService): ConfigValidationResult {
    val errors = mutableListOf<ConfigValidationError>()

    // Check at least one scheduling option
    if (cronExpression == null && interval == null) {
        errors.add(ConfigValidationError("cronExpression", "Either cronExpression or interval must be provided"))
    }

    // Validate cron expression format if provided
    if (cronExpression != null && cronExpression.isBlank()) {
        errors.add(ConfigValidationError("cronExpression", "Cron expression cannot be blank"))
    }

    // Validate interval is positive if provided
    if (interval != null && interval.isNegative) {
        errors.add(ConfigValidationError("interval", "Interval must be positive"))
    }

    // timeZone is required (non-null in constructor), so it's always present

    return ConfigValidationResult(errors)
}
```

Note: The existing `init` block in SCHEDULE already enforces the cron/interval requirement at construction time. The validate() method provides the same check but returns a ConfigValidationResult for consistency with other configs.
  </action>
  <verify>
```bash
./gradlew compileKotlin --quiet 2>&1 | head -20
```
Both trigger configs compile with validate() methods.
  </verify>
  <done>ENTITY_EVENT and SCHEDULE trigger configs have validate() methods</done>
</task>

<task type="auto">
  <name>Task 2: Add validate() methods to FUNCTION and WEBHOOK trigger configs</name>
  <files>
    src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowFunctionTriggerConfig.kt
    src/main/kotlin/riven/core/models/workflow/node/config/trigger/WorkflowWebhookTriggerConfig.kt
  </files>
  <action>
Add validate() methods to both trigger configs.

**WorkflowFunctionTriggerConfig.kt:**

Add imports at top of file (after existing imports):
```kotlin
import riven.core.models.workflow.node.config.validation.ConfigValidationError
import riven.core.models.workflow.node.config.validation.ConfigValidationResult
import riven.core.service.workflow.ConfigValidationService
```

Add validate() method inside the data class (before the execute method):
```kotlin
/**
 * Validates this configuration.
 *
 * Checks:
 * - schema is provided (already non-null in constructor)
 * - schema has valid structure
 */
fun validate(validationService: ConfigValidationService): ConfigValidationResult {
    val errors = mutableListOf<ConfigValidationError>()

    // schema is non-null in constructor, so it's always present
    // Could add deeper schema validation here if needed

    // Validate schema has a label (optional but recommended)
    if (schema.label.isNullOrBlank()) {
        // This is a warning, not an error - schema without label is still valid
        // Just skip for now since we don't have warning-level feedback
    }

    return ConfigValidationResult(errors)
}
```

**WorkflowWebhookTriggerConfig.kt:**

Add imports at top of file (after existing imports):
```kotlin
import riven.core.models.workflow.node.config.validation.ConfigValidationError
import riven.core.models.workflow.node.config.validation.ConfigValidationResult
import riven.core.service.workflow.ConfigValidationService
```

Add validate() method inside the data class (before the execute method):
```kotlin
/**
 * Validates this configuration.
 *
 * Checks:
 * - method is valid (already enforced by enum)
 * - authentication is valid (already enforced by enum)
 * - signature is provided
 * - payloadSchema is provided
 */
fun validate(validationService: ConfigValidationService): ConfigValidationResult {
    val errors = mutableListOf<ConfigValidationError>()

    // method and authentication are enums, always valid if deserialized

    // signature is non-null in constructor
    // Could add deeper signature validation here if needed

    // payloadSchema is non-null in constructor
    // Could add deeper schema validation here if needed

    return ConfigValidationResult(errors)
}
```

Note: Both FUNCTION and WEBHOOK configs have non-null typed fields enforced at construction time. The validate() methods are minimal but provide consistency with the validation pattern used by action and control configs.
  </action>
  <verify>
```bash
./gradlew compileKotlin --quiet 2>&1 | head -20
```
Both trigger configs compile with validate() methods.
  </verify>
  <done>FUNCTION and WEBHOOK trigger configs have validate() methods</done>
</task>

<task type="auto">
  <name>Task 3: Update WorkflowGraphService to validate trigger configs</name>
  <files>src/main/kotlin/riven/core/service/workflow/WorkflowGraphService.kt</files>
  <action>
Update the validateConfig method in WorkflowGraphService (created in Plan 04) to include trigger configs.

In the `validateConfig` method, add cases for trigger configs after the existing action/control cases:

```kotlin
// Add to validateConfig() method's when expression:
is WorkflowEntityEventTriggerConfig -> config.validate(configValidationService)
is WorkflowScheduleTriggerConfig -> config.validate(configValidationService)
is WorkflowFunctionTriggerConfig -> config.validate(configValidationService)
is WorkflowWebhookTriggerConfig -> config.validate(configValidationService)
```

Also add the imports:
```kotlin
import riven.core.models.workflow.node.config.trigger.WorkflowEntityEventTriggerConfig
import riven.core.models.workflow.node.config.trigger.WorkflowScheduleTriggerConfig
import riven.core.models.workflow.node.config.trigger.WorkflowFunctionTriggerConfig
import riven.core.models.workflow.node.config.trigger.WorkflowWebhookTriggerConfig
```

The full validateConfig method should look like:

```kotlin
private fun validateConfig(config: WorkflowNodeConfig): ConfigValidationResult {
    return when (config) {
        // Action configs
        is WorkflowCreateEntityActionConfig -> config.validate(configValidationService)
        is WorkflowUpdateEntityActionConfig -> config.validate(configValidationService)
        is WorkflowDeleteEntityActionConfig -> config.validate(configValidationService)
        is WorkflowQueryEntityActionConfig -> config.validate(configValidationService)
        is WorkflowHttpRequestActionConfig -> config.validate(configValidationService)
        // Control configs
        is WorkflowConditionControlConfig -> config.validate(configValidationService, expressionParserService)
        // Trigger configs
        is WorkflowEntityEventTriggerConfig -> config.validate(configValidationService)
        is WorkflowScheduleTriggerConfig -> config.validate(configValidationService)
        is WorkflowFunctionTriggerConfig -> config.validate(configValidationService)
        is WorkflowWebhookTriggerConfig -> config.validate(configValidationService)
        // Other configs without validation yet
        else -> ConfigValidationResult.valid()
    }
}
```
  </action>
  <verify>
```bash
./gradlew compileKotlin --quiet 2>&1 | head -20
```
WorkflowGraphService compiles with trigger config validation.
  </verify>
  <done>WorkflowGraphService validates all 4 trigger configs on save</done>
</task>

</tasks>

<verification>
1. All 4 trigger configs have validate() method
2. Each validate() method returns ConfigValidationResult
3. WorkflowGraphService routes to trigger validate() methods
4. `./gradlew compileKotlin` succeeds
</verification>

<success_criteria>
- WorkflowEntityEventTriggerConfig has validate() that checks key and expressions
- WorkflowScheduleTriggerConfig has validate() that checks cronExpression/interval
- WorkflowFunctionTriggerConfig has validate() that checks schema
- WorkflowWebhookTriggerConfig has validate() that checks signature and payloadSchema
- WorkflowGraphService.validateConfig handles all 4 trigger types
- No compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-node-configuration-development/07.1-05-SUMMARY.md`
</output>
