---
phase: 07.1-node-configuration-development
plan: 02
subsystem: workflow-node-configs
tags: [entity-actions, typed-configs, validation]
dependency-graph:
  requires: [07.1-01]
  provides: [typed-entity-action-configs, entity-config-validation]
  affects: [07.1-03, 07.1-04, 07.1-05]
tech-stack:
  patterns: [typed-config-properties, config-map-getter]
key-files:
  modified:
    - src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowCreateEntityActionConfig.kt
    - src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowUpdateEntityActionConfig.kt
    - src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowDeleteEntityActionConfig.kt
    - src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowQueryEntityActionConfig.kt
    - src/main/kotlin/riven/core/models/workflow/node/config/actions/WorkflowHttpRequestActionConfig.kt
decisions:
  - key: config-map-getter
    choice: Add computed config property returning typed fields as map
    rationale: WorkflowCoordinationService requires .config property for template resolution
  - key: entity-payload-wrapper
    choice: Use EntityAttributeRequest with TEXT SchemaType default
    rationale: SaveEntityRequest requires proper payload wrapper; schema type inference deferred
metrics:
  duration: 5m
  completed: 2026-01-29
---

# Phase 7.1 Plan 02: Entity Action Configs Summary

**One-liner:** Typed configs for CREATE/UPDATE/DELETE/QUERY entity actions with validation and payload mapping

## What Was Built

Refactored all four entity action configs from untyped `config: JsonObject/Map` to strongly-typed properties:

### WorkflowCreateEntityActionConfig
- `entityTypeId: String` - Template-enabled UUID of entity type
- `payload: Map<String, String>` - Template map of attribute values
- `timeoutSeconds: Long?` - Optional timeout override
- `validate()` method using ConfigValidationService
- `config` getter for template resolution compatibility
- Fixed payload mapping using EntityAttributeRequest wrapper

### WorkflowUpdateEntityActionConfig
- `entityId: String` - Template-enabled UUID of entity to update
- `payload: Map<String, String>` - Template map of attribute values
- `timeoutSeconds: Long?` - Optional timeout override
- `validate()` method using ConfigValidationService
- `config` getter for template resolution compatibility
- Fixed payload mapping using EntityAttributeRequest wrapper

### WorkflowDeleteEntityActionConfig
- `entityId: String` - Template-enabled UUID of entity to delete
- `timeoutSeconds: Long?` - Optional timeout override
- `validate()` method using ConfigValidationService
- `config` getter for template resolution compatibility

### WorkflowQueryEntityActionConfig
- `entityId: String` - Template-enabled UUID of entity to query
- `timeoutSeconds: Long?` - Optional timeout override
- `validate()` method using ConfigValidationService
- `config` getter for template resolution compatibility

## Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Config map getter pattern | Add computed `config` property | WorkflowCoordinationService requires `.config` for template resolution; maintains backward compatibility |
| Entity payload wrapping | Use EntityAttributeRequest with TEXT default | SaveEntityRequest requires `Map<UUID, EntityAttributeRequest>`; proper schema type inference deferred |
| Blocking issue fix | Also fixed WorkflowHttpRequestActionConfig | Missing `.config` property was blocking compilation |

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Fixed WorkflowHttpRequestActionConfig missing config property**
- **Found during:** Task 1 verification
- **Issue:** WorkflowHttpRequestActionConfig (from 07.1-03) was missing `.config` property, causing WorkflowCoordinationService compilation error
- **Fix:** Added `config` getter returning typed fields as map
- **Files modified:** WorkflowHttpRequestActionConfig.kt
- **Commit:** 60093c1

## Commits

| Hash | Description |
|------|-------------|
| 60093c1 | feat(07.1-02): refactor WorkflowCreateEntityActionConfig with typed fields |
| 689248f | feat(07.1-02): refactor WorkflowUpdateEntityActionConfig with typed fields |
| bd1a158 | feat(07.1-02): refactor WorkflowDeleteEntityActionConfig and WorkflowQueryEntityActionConfig |

## Verification

- [x] All entity action configs compile without errors
- [x] Each config has typed fields (entityTypeId/entityId, payload, timeoutSeconds)
- [x] Each config has `validate()` method returning ConfigValidationResult
- [x] Each config has `config` getter for template resolution
- [x] execute() methods properly handle resolved inputs with EntityAttributeRequest wrapping
- [x] `./gradlew compileKotlin` succeeds

## Next Phase Readiness

Ready for 07.1-03: HTTP_REQUEST and CONDITION configs (note: HTTP already done as blocking fix)
- HTTP config was fixed as part of this plan due to blocking compilation issue
- CONDITION config should be the primary focus of 07.1-03
