# Phase 6.1: Execution Queue Management - Context

**Gathered:** 2026-01-19
**Status:** Ready for planning

<domain>
## Phase Boundary

Backend infrastructure for handling high volumes of workflow execution requests through Temporal. This phase implements request queuing, worker configuration, task queue organization, and concurrency limits to ensure the system handles load gracefully while providing workspace isolation.

</domain>

<decisions>
## Implementation Decisions

### Task Queue Organization
- Queue per workspace for tenant isolation: `workflow.workspace.{workspaceId}`
- Separate queues for internal/system workflows: `workflows.default`
- Dedicated queue for external API activities: `activities.external-api`
- Convention-based naming pattern (predictable, easy to debug)

### Worker Configuration
- Shared worker pool across workspaces (efficient resource use)
- Workers poll multiple workspace queues
- Multiple task queue builders — one for each queue type (workspace, default, external-api)

### Concurrency Limits
- Fixed concurrent execution limit per workspace
- Limits are tier-based (configured via workspace tier enum):
  - Pro tier: 5 concurrent workflow executions
  - Enterprise tier: 10 concurrent workflow executions
- Workspace tier stored in workspace database table
- Enum defines max concurrent/config for each tier
- Non-tenant queues (`workflows.default`, `activities.external-api`) have their own separate configurable limits

### Queue Behavior
- When workspace hits limit: queue and wait (requests wait until slot available)
- No per-workflow limits — only workspace-level limits apply
- FIFO ordering — first-in-first-out, no priority levels

### Application-Level Queue
- Application manages queue before dispatching to Temporal (more control)
- Database-backed queue (PostgreSQL) — survives restarts, durable
- Polling scheduler processes queue at intervals (background job checks periodically)

### Claude's Discretion
- Activity thread pool configuration (sensible defaults based on Temporal recommendations)
- Polling interval for queue processor
- Exact default limits for non-tenant queues

</decisions>

<specifics>
## Specific Ideas

- Queue naming examples: `workflows.default`, `workflow.workspace.xxx`, `workflow.workspace.yyy`, `activities.external-api`
- Tier-based configuration allows billing/plan integration later
- Database-backed queue ensures no lost executions on service restart

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 06.1-execution-queue-management*
*Context gathered: 2026-01-19*
