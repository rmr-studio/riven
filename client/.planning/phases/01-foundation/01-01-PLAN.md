---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/api/block-api.ts
  - lib/api/user-api.ts
  - lib/api/workspace-api.ts
  - lib/types/.openapi-generator-ignore
autonomous: true

must_haves:
  truths:
    - "createBlockApi(session) returns configured BlockApi instance"
    - "createUserApi(session) returns configured UserApi instance"
    - "createWorkspaceApi(session) returns configured WorkspaceApi instance"
    - "Running npm run types does not delete lib/types/entity/, lib/types/block/, lib/types/workspace/, or lib/types/user/ directories"
  artifacts:
    - path: "lib/api/block-api.ts"
      provides: "BlockApi factory function"
      exports: ["createBlockApi"]
    - path: "lib/api/user-api.ts"
      provides: "UserApi factory function"
      exports: ["createUserApi"]
    - path: "lib/api/workspace-api.ts"
      provides: "WorkspaceApi factory function"
      exports: ["createWorkspaceApi"]
    - path: "lib/types/.openapi-generator-ignore"
      provides: "Directory protection patterns"
      contains: "entity/**"
  key_links:
    - from: "lib/api/block-api.ts"
      to: "@/lib/types"
      via: "import BlockApi, Configuration"
      pattern: "import.*BlockApi.*Configuration.*from"
    - from: "lib/api/user-api.ts"
      to: "@/lib/types"
      via: "import UserApi, Configuration"
      pattern: "import.*UserApi.*Configuration.*from"
    - from: "lib/api/workspace-api.ts"
      to: "@/lib/types"
      via: "import WorkspaceApi, Configuration"
      pattern: "import.*WorkspaceApi.*Configuration.*from"
---

<objective>
Create API factory functions for BlockApi, UserApi, and WorkspaceApi, and protect custom type directories from regeneration.

Purpose: Establishes the foundation for service migration by providing configured API instances and ensuring custom barrel directories survive code generation.

Output:
- 3 API factory files in `lib/api/`
- Updated `.openapi-generator-ignore` with directory protection patterns
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing pattern to follow
@lib/api/entity-api.ts

# Research with exact code examples
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create API factory functions</name>
  <files>lib/api/block-api.ts, lib/api/user-api.ts, lib/api/workspace-api.ts</files>
  <action>
Create three API factory files following the exact pattern from `lib/api/entity-api.ts`:

For each file:
1. Import the specific API class and Configuration from `@/lib/types`
2. Import Session from `@/lib/auth`
3. Export a function named `create{Api}Api(session: Session): {Api}Api`
4. Validate `NEXT_PUBLIC_API_URL` exists, throw descriptive error if missing
5. Create Configuration with basePath and async accessToken function
6. Return constructed API instance

The pattern is identical for all three - only the API class name changes:
- `block-api.ts`: BlockApi, createBlockApi
- `user-api.ts`: UserApi, createUserApi
- `workspace-api.ts`: WorkspaceApi, createWorkspaceApi

Include JSDoc comments matching the entity-api.ts style.
  </action>
  <verify>
TypeScript compiles without errors:
```bash
npx tsc --noEmit lib/api/block-api.ts lib/api/user-api.ts lib/api/workspace-api.ts
```
  </verify>
  <done>
- lib/api/block-api.ts exports createBlockApi function
- lib/api/user-api.ts exports createUserApi function
- lib/api/workspace-api.ts exports createWorkspaceApi function
- All three follow the entity-api.ts pattern exactly
  </done>
</task>

<task type="auto">
  <name>Task 2: Update generator ignore file</name>
  <files>lib/types/.openapi-generator-ignore</files>
  <action>
Update `.openapi-generator-ignore` to protect custom directories from deletion during code regeneration.

Add the following lines after the existing comments:

```
# Protect custom domain barrel directories from regeneration
# These directories will contain re-exports and custom types (Phase 2)
entity/**
block/**
workspace/**
user/**
```

These patterns protect the four directories that will be created in Phase 2 for domain-based type barrels.
  </action>
  <verify>
Create test directories, run generation, verify they survive:
```bash
# Create test directories
mkdir -p lib/types/entity lib/types/block lib/types/workspace lib/types/user
touch lib/types/entity/test.txt lib/types/block/test.txt lib/types/workspace/test.txt lib/types/user/test.txt

# Run generation
npm run types

# Verify directories still exist
ls lib/types/entity/test.txt lib/types/block/test.txt lib/types/workspace/test.txt lib/types/user/test.txt

# Clean up test files
rm lib/types/entity/test.txt lib/types/block/test.txt lib/types/workspace/test.txt lib/types/user/test.txt
```
  </verify>
  <done>
- `.openapi-generator-ignore` contains patterns: entity/**, block/**, workspace/**, user/**
- Running `npm run types` does not delete the protected directories
  </done>
</task>

</tasks>

<verification>
1. All three API factory files exist and export their factory functions
2. TypeScript compilation succeeds for all files
3. Generator ignore file contains all four directory patterns
4. Protected directories survive `npm run types` execution
</verification>

<success_criteria>
- `createBlockApi(session)` returns configured BlockApi instance
- `createUserApi(session)` returns configured UserApi instance
- `createWorkspaceApi(session)` returns configured WorkspaceApi instance
- Running `npm run types` does not delete `lib/types/entity/`, `lib/types/block/`, `lib/types/workspace/`, or `lib/types/user/` directories
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
