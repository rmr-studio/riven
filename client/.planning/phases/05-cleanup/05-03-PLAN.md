---
phase: 05-cleanup
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified:
  - components/feature-modules/workspace/**/*.ts
  - components/feature-modules/workspace/**/*.tsx
  - components/feature-modules/user/**/*.tsx
  - components/feature-modules/authentication/**/*.ts
  - components/feature-modules/authentication/**/*.tsx
  - lib/interfaces/template.interface.ts
  - lib/types/types.ts
  - CLAUDE.md
autonomous: true

must_haves:
  truths:
    - "No files import from workspace.interface.ts"
    - "No files import from user.interface.ts"
    - "No files import from auth.interface.ts"
    - "lib/types/types.ts is deleted"
    - "CLAUDE.md documents new import patterns"
  artifacts:
    - path: "lib/types/workspace/custom.ts"
      provides: "Workspace operation types"
      contains: "GetWorkspacePathParams"
    - path: "lib/types/user/custom.ts"
      provides: "User operation types"
      contains: "UpdateUserProfileRequest"
    - path: "CLAUDE.md"
      provides: "Updated documentation with new type import patterns"
      contains: "@/lib/types/entity"
  key_links:
    - from: "CLAUDE.md"
      to: "lib/types/{domain}"
      via: "documentation examples"
      pattern: "@/lib/types/(entity|block|workspace|user)"
---

<objective>
Update workspace/user/auth domain imports, delete remaining interface files, delete types.ts, and update CLAUDE.md documentation.

Purpose: Complete the OpenAPI migration cleanup by removing all legacy files and updating documentation.
Output: All interface files deleted; types.ts deleted; CLAUDE.md updated with new patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-cleanup/05-CONTEXT.md
@.planning/phases/05-cleanup/05-RESEARCH.md

# Domain barrels (target imports)
@lib/types/workspace/index.ts
@lib/types/workspace/custom.ts
@lib/types/user/index.ts
@lib/types/user/custom.ts

# Files to delete
@components/feature-modules/workspace/interface/workspace.interface.ts
@components/feature-modules/user/interface/user.interface.ts
@components/feature-modules/authentication/interface/auth.interface.ts
@lib/interfaces/template.interface.ts
@lib/types/types.ts

# Documentation to update
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update workspace/user/auth imports and delete interface files</name>
  <files>
    - components/feature-modules/workspace/components/form/workspace-form.tsx
    - components/feature-modules/workspace/service/workspace.service.ts
    - components/ui/sidebar/dashboard-sidebar.tsx
    - components/feature-modules/workspace/components/edit-workspace.tsx
    - components/feature-modules/workspace/components/new-workspace.tsx
    - components/feature-modules/workspace/components/workspace-card.tsx
    - components/feature-modules/workspace/dashboard/workspace-picker.tsx
    - components/feature-modules/workspace/hooks/mutation/use-save-workspace-mutation.tsx
    - components/feature-modules/workspace/hooks/query/use-workspace-members.tsx
    - components/feature-modules/workspace/store/workspace.store.ts
    - components/ui/nav/navbar.content.tsx
    - components/feature-modules/onboarding/components/OnboardForm.tsx
    - components/feature-modules/user/components/avatar-dropdown.tsx
    - components/feature-modules/authentication/components/Register.tsx
    - components/feature-modules/authentication/components/RegisterConfirmation.tsx
    - components/feature-modules/authentication/util/auth.util.ts
    - components/feature-modules/workspace/interface/workspace.interface.ts (delete)
    - components/feature-modules/user/interface/user.interface.ts (delete)
    - components/feature-modules/authentication/interface/auth.interface.ts (delete)
    - lib/interfaces/template.interface.ts (delete)
  </files>
  <action>
    **Phase A: Update workspace imports (11 files)**

    Replace `from "@/components/feature-modules/workspace/interface/workspace.interface"` with `from "@/lib/types/workspace"`:
    - Workspace, WorkspaceMember, WorkspaceInvite -> @/lib/types/workspace
    - SaveWorkspaceRequest -> @/lib/types/workspace
    - Path/Query params (GetWorkspacePathParams, etc.) -> @/lib/types/workspace (from custom.ts)

    **Phase B: Update user imports (4 files)**

    Replace `from "@/components/feature-modules/user/interface/user.interface"` with `from "@/lib/types/user"`:
    - User -> @/lib/types/user
    - Request/Response types -> @/lib/types/user (from custom.ts)

    **Phase C: Handle auth interface differently**

    The auth.interface.ts contains Supabase-specific types NOT from OpenAPI:
    - SocialProviders, AuthenticationCredentials, RegistrationConfirmation, AuthResponse, MobileVerificationHelper

    Two options:
    1. Keep auth.interface.ts in place (it's auth-framework-specific, not OpenAPI migration scope)
    2. Move types to a local auth types file

    Per CONTEXT.md guidance ("auth interface: custom types, may need local migration"), KEEP the auth.interface.ts file since these are Supabase auth types, not OpenAPI types.

    **Do NOT delete auth.interface.ts** - update the plan to reflect this is intentionally kept.

    **Phase D: Delete interface files**

    Delete in order:
    1. `rm components/feature-modules/workspace/interface/workspace.interface.ts`
    2. `rm components/feature-modules/user/interface/user.interface.ts`
    3. `rm lib/interfaces/template.interface.ts` (0 consumers, references non-existent schemas)

    **Note:** Keep `components/feature-modules/authentication/interface/auth.interface.ts` - it contains auth-framework-specific types.
  </action>
  <verify>
    Run: `grep -r "from.*workspace\.interface" components/ --include="*.ts" --include="*.tsx" 2>/dev/null | wc -l`
    Expected: 0

    Run: `grep -r "from.*user\.interface" components/ --include="*.ts" --include="*.tsx" 2>/dev/null | wc -l`
    Expected: 0

    Run: `ls components/feature-modules/workspace/interface/workspace.interface.ts components/feature-modules/user/interface/user.interface.ts lib/interfaces/template.interface.ts 2>&1`
    Expected: "No such file" errors for all three
  </verify>
  <done>Workspace/user imports updated; workspace.interface.ts, user.interface.ts, template.interface.ts deleted; auth.interface.ts intentionally kept</done>
</task>

<task type="auto">
  <name>Task 2: Delete lib/types/types.ts and update remaining references</name>
  <files>
    - lib/types/types.ts
    - lib/types/block/responses.ts
    - lib/types/user/custom.ts
    - lib/types/workspace/custom.ts
    - lib/interfaces/common.interface.ts
  </files>
  <action>
    **Pre-check: Verify remaining types.ts references**

    After Plans 05-01 and 05-02, the only remaining references to types.ts should be in:
    - lib/types/block/responses.ts (internal barrel use - OK)
    - lib/types/user/custom.ts (internal barrel use - OK)
    - lib/types/workspace/custom.ts (internal barrel use - OK)
    - lib/interfaces/common.interface.ts (needs update)
    - Planning docs (.planning/) - documentation only, OK

    **Update lib/interfaces/common.interface.ts:**

    Current content imports from `@/lib/types`:
    ```typescript
    import { Condition, FormStructure, Icon, SchemaOptions, SchemaString, SchemaUUID } from "@/lib/types";
    ```

    Update to import from specific domain barrels:
    ```typescript
    import type { Condition, FormStructure, Icon, SchemaOptions, SchemaString, SchemaUUID } from "@/lib/types/common";
    ```

    Or, since common.interface.ts mostly re-exports these types, consider whether consumers should import directly from @/lib/types/common instead. For now, update the import to use the common barrel.

    **Update internal barrel files if needed:**

    Check if lib/types/block/responses.ts, lib/types/user/custom.ts, lib/types/workspace/custom.ts import from types.ts:
    - If they import `components` or `operations` from types.ts, update to use the pattern from models.ts
    - These should already be correct from Phase 2/3

    **Delete types.ts:**

    After all references updated:
    `rm lib/types/types.ts`

    **Note:** The main barrel `lib/types/index.ts` should NOT be deleted - it re-exports from models.ts and is the public API.
  </action>
  <verify>
    Run: `grep -r "from.*types/types" lib/ components/ --include="*.ts" --include="*.tsx" 2>/dev/null | grep -v ".planning" | wc -l`
    Expected: 0 (no code imports from types.ts)

    Run: `ls lib/types/types.ts 2>&1`
    Expected: "No such file or directory"

    Run: `tsc --noEmit 2>&1 | grep -c "error TS"`
    Expected: Same or fewer errors than baseline (281)
  </verify>
  <done>lib/types/types.ts deleted; all internal references updated to use domain barrels</done>
</task>

<task type="auto">
  <name>Task 3: Update CLAUDE.md documentation</name>
  <files>
    - CLAUDE.md
  </files>
  <action>
    Update CLAUDE.md to reflect the new type import patterns established by the OpenAPI migration.

    **Sections to update:**

    1. **Section "1. Type Safety with OpenAPI"** - Update the example and guidance:

    OLD:
    ```typescript
    // lib/types/types.ts - generated from OpenAPI spec
    import { components } from "@/lib/types/types";

    // feature-modules/entity/interface/entity.interface.ts - semantic re-exports
    export type EntityType = components["schemas"]["EntityType"];
    ```
    **Always use re-exported types from feature interfaces, never import directly from lib/types.**

    NEW:
    ```typescript
    // Domain barrels aggregate generated types, custom types, and guards
    import type { EntityType, EntityRelationshipDefinition } from "@/lib/types/entity";
    import type { BlockType, BlockNode, EditorEnvironment } from "@/lib/types/block";
    import type { Workspace, WorkspaceMember } from "@/lib/types/workspace";
    import type { User } from "@/lib/types/user";

    // Enums are runtime values - use regular import
    import { EntityPropertyType, RelationshipLimit } from "@/lib/types/entity";
    import { BlockMetadataType, NodeType, LayoutCommandType } from "@/lib/types/block";

    // Type guards
    import { isRelationshipDefinition } from "@/lib/types/entity";
    import { isContentMetadata, isContentNode } from "@/lib/types/block";
    ```
    **Import types from `@/lib/types/{domain}` barrels. Never import from `components["schemas"]` directly.**

    2. **Section on "Directory Structure"** - Ensure lib/types structure is documented:
    ```
    ├── lib/
    │   ├── types/                             # OpenAPI-generated + domain barrels
    │   │   ├── entity/                        # Entity domain types
    │   │   │   ├── index.ts                   # Barrel export
    │   │   │   ├── models.ts                  # Generated model types
    │   │   │   ├── custom.ts                  # Custom entity types
    │   │   │   └── guards.ts                  # Type guard functions
    │   │   ├── block/                         # Block domain types
    │   │   ├── workspace/                     # Workspace domain types
    │   │   ├── user/                          # User domain types
    │   │   └── common/                        # Shared types (Icon, etc.)
    ```

    3. **Development Gotchas section** - Update/remove outdated items:
    - REMOVE: "Never import types directly from `lib/types/types.ts`" (file no longer exists)
    - KEEP: "Enums can be imported directly from `libs/types.ts`" -> UPDATE to "Enums are exported from domain barrels as runtime values"
    - ADD: "Use `import type` for type-only imports, regular `import` for enums and guards (runtime values)"

    4. **Code Conventions section** - Verify type safety example uses new pattern

    5. **Feature Module Pattern section** - Update interface subdirectory description:
    - OLD: "interface/ - TypeScript interfaces (re-exports OpenAPI types)"
    - NEW: "interface/ - Feature-specific interfaces (auth types, etc.) - most types now in @/lib/types/{domain}"

    **Do NOT change:**
    - Project overview, tech stack, architecture fundamentals
    - Service layer patterns, TanStack Query patterns
    - Any unrelated sections
  </action>
  <verify>
    Run: `grep -c "@/lib/types/entity" CLAUDE.md`
    Expected: >= 2 (examples show new import pattern)

    Run: `grep -c "lib/types/types.ts" CLAUDE.md`
    Expected: 0 (no references to deleted file, except historical context if any)

    Run: `grep -c "feature interfaces" CLAUDE.md`
    Expected: 0 (old guidance removed)
  </verify>
  <done>CLAUDE.md updated with new domain barrel import patterns; old patterns removed</done>
</task>

</tasks>

<verification>
1. `grep -rE "from.*(workspace|user)\.interface" components/ --include="*.ts" --include="*.tsx" 2>/dev/null | wc -l` returns 0
2. `ls lib/types/types.ts 2>&1` returns "No such file or directory"
3. `grep -c "@/lib/types/entity" CLAUDE.md` returns >= 2
4. `tsc --noEmit 2>&1 | grep -c "error TS"` returns <= 281 (baseline)
</verification>

<success_criteria>
- [ ] Zero imports from workspace.interface.ts in codebase
- [ ] Zero imports from user.interface.ts in codebase
- [ ] workspace.interface.ts, user.interface.ts, template.interface.ts deleted
- [ ] auth.interface.ts intentionally kept (Supabase auth types)
- [ ] lib/types/types.ts deleted
- [ ] CLAUDE.md updated with new import patterns
- [ ] TypeScript error count unchanged or decreased from baseline (281)
- [ ] Application builds successfully: `npm run build`
</success_criteria>

<output>
After completion, create `.planning/phases/05-cleanup/05-03-SUMMARY.md`
</output>
